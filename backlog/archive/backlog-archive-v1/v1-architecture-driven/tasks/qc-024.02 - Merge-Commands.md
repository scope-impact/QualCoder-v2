---
id: QC-024.02
title: Merge Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:44'
labels:
  - application
  - collaboration
  - P1
dependencies: []
parent_task_id: QC-024
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: DetectConflicts, MergeCodes (with resolution), ResolveConflict, PreviewMerge. Support undo.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `detect_conflicts(source_code_id, target_code_id) -> List[MergeConflict]`
- [ ] #2 `preview_merge(source_code_id, target_code_id, resolutions) -> MergePreview`
- [ ] #3 `execute_merge(plan: MergePlan) -> Result[MergeCompleted, MergeError]`
- [ ] #4 `resolve_conflict(conflict_id, resolution: ResolutionStrategy) -> Result[None, Error]`

### MergePreview Value Object
- [ ] #5 `MergePreview`: segments_to_reassign, conflicts_resolved, will_delete_code

### Controller Flow
- [ ] #6 Detect → Preview → User reviews → Resolve conflicts → Execute
- [ ] #7 Transaction-wrapped execution
- [ ] #8 Rollback support via undo

### Event Publishing
- [ ] #9 `MergeStarted` event when user initiates
- [ ] #10 `ConflictDetected` event for each conflict found
- [ ] #11 `ConflictResolved` event when user resolves
- [ ] #12 `MergeCompleted` event on success

### Error Handling
- [ ] #13 `MergeError`: UnresolvedConflicts, CodeNotFound, CircularReference
- [ ] #14 Returns Result[T, MergeError]
<!-- AC:END -->
