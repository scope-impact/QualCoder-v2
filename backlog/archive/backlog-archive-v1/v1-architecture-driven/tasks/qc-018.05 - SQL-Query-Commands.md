---
id: QC-018.05
title: SQL Query Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:42'
labels:
  - application
  - analysis
  - P2
dependencies: []
parent_task_id: QC-018
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: ExecuteSQLQuery (read-only), SaveSQLQuery, LoadSQLQuery, ListSavedQueries. Validate query safety.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `execute_sql_query(query: str) -> Result[QueryResult, QueryError]`
- [ ] #2 `save_sql_query(name, query) -> Result[SavedQueryId, Error]`
- [ ] #3 `load_sql_query(query_id) -> Result[SavedQuery, Error]`
- [ ] #4 `list_saved_queries() -> List[SavedQuery]`
- [ ] #5 `delete_sql_query(query_id) -> Result[None, Error]`

### Query Safety
- [ ] #6 Validate query is read-only (SELECT only)
- [ ] #7 Reject dangerous operations (DROP, DELETE, etc.)
- [ ] #8 Timeout protection (default 30 seconds)

### Default Queries
- [ ] #9 Pre-built queries for common tasks
- [ ] #10 "All codes with counts", "Segments by source", etc.
- [ ] #11 User cannot modify default queries

### Result Handling
- [ ] #12 `QueryResult`: columns, rows, row_count, execution_time_ms
- [ ] #13 Results exportable to CSV/Excel

### Error Handling
- [ ] #14 `QueryError`: InvalidSQL, Forbidden, Timeout, ExecutionFailed
- [ ] #15 User-friendly error messages

### Audit Trail
- [ ] #16 Log executed queries for debugging
<!-- AC:END -->
