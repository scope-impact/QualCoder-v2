---
id: QC-012.02
title: Partial Case Linking
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - domain
  - cases
  - P1
dependencies: []
parent_task_id: QC-012
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Value objects for partial case-file linking: CaseMemberPosition (start, end positions for partial text). Support linking text segments to cases.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### CaseMembership Value Object (frozen dataclass)
- [ ] #1 `CaseMembership`: case_id, source_id, link_type (LinkType), position (Optional[TextPosition]), owner
- [ ] #2 `LinkType` enum: FULL (entire source), PARTIAL (text segment)
- [ ] #3 For FULL link: position is None
- [ ] #4 For PARTIAL link: position contains TextPosition (start, end)

### TextPosition Value Object (reuse from Coding domain)
- [ ] #5 `TextPosition`: start (int), end (int)
- [ ] #6 Methods: `length() -> int`, `overlaps(other) -> bool`, `contains(pos) -> bool`
- [ ] #7 Immutable - compared by value

### Pure Functions
- [ ] #8 `create_full_membership(case_id, source_id, owner) -> CaseMembership`
- [ ] #9 `create_partial_membership(case_id, source_id, start, end, owner) -> CaseMembership`
- [ ] #10 `is_membership_overlap(m1, m2) -> bool` - detects overlapping partial links

### Invariants
- [ ] #11 `is_valid_partial_position(position, source) -> bool` - within source bounds
- [ ] #12 `is_unique_membership(case_id, source_id, position, existing) -> bool` - no duplicate links
- [ ] #13 `is_position_non_empty(position) -> bool` - start < end

### Auto-Assignment Support
- [ ] #14 `find_text_by_markers(source_text, start_marker, end_marker) -> List[TextPosition]`
- [ ] #15 Supports auto-assignment of partial text to cases by marker patterns
<!-- AC:END -->
