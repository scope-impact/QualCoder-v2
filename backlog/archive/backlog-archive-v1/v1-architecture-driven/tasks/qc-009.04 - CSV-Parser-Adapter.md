---
id: QC-009.04
title: CSV Parser Adapter
status: To Do
assignee: []
created_date: '2026-01-29 16:40'
labels:
  - infrastructure
  - sources
  - P2
dependencies: []
parent_task_id: QC-009
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
CSV parsing adapter for survey import: detect delimiter, parse headers, preview rows, stream large files. Support various encodings.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### CSVParserAdapter Interface
- [ ] #1 `detect_delimiter(sample: str) -> DelimiterType` - analyzes first N lines
- [ ] #2 `parse_headers(path: Path, delimiter: DelimiterType) -> List[str]`
- [ ] #3 `preview_rows(path: Path, config: SurveyConfig, limit: int = 10) -> List[List[str]]`
- [ ] #4 `stream_rows(path: Path, config: SurveyConfig) -> Iterator[List[str]]` - memory efficient

### Encoding Detection
- [ ] #5 `detect_encoding(path: Path) -> Encoding` - uses chardet or similar
- [ ] #6 Supported encodings: UTF-8, UTF-16, Latin-1, CP1252, ASCII
- [ ] #7 Falls back to UTF-8 with error replacement if detection fails

### Validation
- [ ] #8 `validate_csv(path: Path, config: SurveyConfig) -> Result[CSVValidation, CSVError]`
- [ ] #9 `CSVValidation`: row_count, column_count, empty_rows, inconsistent_rows
- [ ] #10 `CSVError` union: FileNotFound, EncodingError, MalformedCSV, InconsistentColumns

### Pure Functions
- [ ] #11 `parse_row(line: str, delimiter: str) -> List[str]` - handles quoted fields
- [ ] #12 `infer_column_types(rows: List[List[str]]) -> List[ColumnType]` - based on sample
- [ ] #13 `clean_value(value: str) -> str` - trims whitespace, normalizes quotes

### Streaming Support
- [ ] #14 Large files (>100MB) processed via streaming, not loaded into memory
- [ ] #15 Progress callback: `on_progress(rows_processed: int, total_rows: int)`
<!-- AC:END -->
