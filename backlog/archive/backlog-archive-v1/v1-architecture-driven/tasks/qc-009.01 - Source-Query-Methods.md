---
id: QC-009.01
title: Source Query Methods
status: To Do
assignee: []
created_date: '2026-01-29 16:40'
labels:
  - infrastructure
  - sources
  - P0
dependencies: []
parent_task_id: QC-009
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Repository query methods: find_all with filtering/sorting, find_by_type, find_by_case, find_linked, count_by_type, get_statistics. Support pagination for large source lists.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Repository Methods (SourceRepository)
- [ ] #1 `find_all(filter: SourceFilter, sort: SortSpec, page: PageSpec) -> Page[Source]`
- [ ] #2 `find_by_type(source_type: SourceType) -> List[Source]` - TEXT, IMAGE, AUDIO, VIDEO, PDF
- [ ] #3 `find_by_case(case_id: CaseId) -> List[Source]` - sources linked to case
- [ ] #4 `find_linked() -> List[Source]` - externally linked files (not copied)
- [ ] #5 `count_by_type() -> Dict[SourceType, int]` - aggregate counts

### Query DTOs (Read-only)
- [ ] #6 `SourceFilter` value object: name_pattern, source_types, date_range, has_segments (bool)
- [ ] #7 `SortSpec` value object: field (name|date|type|segments), direction (ASC|DESC)
- [ ] #8 `PageSpec` value object: offset, limit (default 50)
- [ ] #9 `Page[T]` generic: items, total_count, has_more

### Statistics Query
- [ ] #10 `get_statistics() -> SourceStatistics` - total files, by type, total size, coded count
- [ ] #11 `SourceStatistics` DTO: total_count, by_type (dict), total_size_bytes, coded_count, uncoded_count

### Immutability
- [ ] #12 All returned entities are frozen dataclasses
- [ ] #13 Repository converts SQLite rows â†’ domain Source entities via factory
- [ ] #14 Queries are read-only, never modify state
<!-- AC:END -->
