---
id: QC-020.03
title: Chat Session Service
status: To Do
assignee: []
created_date: '2026-01-29 16:43'
labels:
  - application
  - ai-assistant
  - P0
dependencies: []
parent_task_id: QC-020
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
ChatSessionService: manage AI chat conversations, message history, context tracking, quick prompt handling. Persist conversation history.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Chat Value Objects (frozen dataclasses)
- [ ] #1 `ChatMessage`: message_id, role (USER|ASSISTANT|SYSTEM), content, timestamp
- [ ] #2 `ChatSession`: session_id, messages (List[ChatMessage]), context, created_at
- [ ] #3 Immutable - new messages create new session state

### ChatSessionService Interface
- [ ] #4 `create_session() -> ChatSession` - starts new conversation
- [ ] #5 `add_message(session_id, role, content) -> Result[ChatMessage, Error]`
- [ ] #6 `get_session(session_id) -> Optional[ChatSession]`
- [ ] #7 `get_session_history(limit) -> List[ChatSession]`
- [ ] #8 `clear_session(session_id) -> Result[None, Error]`

### Context Management
- [ ] #9 `set_context(session_id, context: CodingContext)` - current selection/code
- [ ] #10 `CodingContext`: selected_text, source_id, code_id (optional)

### Quick Prompts
- [ ] #11 `execute_quick_prompt(prompt_type, context) -> Result[Response, Error]`
- [ ] #12 `QuickPromptType` enum: SUGGEST_CODES, SUMMARIZE, FIND_SIMILAR, EXPLAIN

### Persistence
- [ ] #13 Sessions persisted to SQLite for history
- [ ] #14 Load previous sessions on startup
<!-- AC:END -->
