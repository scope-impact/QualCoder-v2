---
id: QC-009.05
title: Media File Validator
status: To Do
assignee: []
created_date: '2026-01-29 16:40'
labels:
  - infrastructure
  - sources
  - P1
dependencies: []
parent_task_id: QC-009
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Media file validation: check format support, extract metadata (duration, resolution), validate file integrity. Support mp3, mp4, wav, mkv, mov.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### MediaValidator Interface
- [ ] #1 `validate(path: Path) -> Result[MediaInfo, MediaError]`
- [ ] #2 `is_supported_format(path: Path) -> bool` - checks extension and magic bytes
- [ ] #3 `extract_metadata(path: Path) -> Result[MediaMetadata, MediaError]`

### MediaInfo Value Object (frozen dataclass)
- [ ] #4 `MediaInfo`: media_type (AUDIO|VIDEO|IMAGE), format, is_valid, metadata
- [ ] #5 `AudioMetadata`: duration_ms, sample_rate, channels, bitrate, codec
- [ ] #6 `VideoMetadata`: duration_ms, width, height, fps, codec, has_audio
- [ ] #7 `ImageMetadata`: width, height, format, color_mode

### Supported Formats
- [ ] #8 Audio: mp3, wav, ogg, flac, m4a, aac
- [ ] #9 Video: mp4, mkv, mov, avi, webm
- [ ] #10 Image: jpg, jpeg, png, gif, bmp, tiff

### Validation Checks
- [ ] #11 File exists and is readable
- [ ] #12 Magic bytes match expected format (not just extension)
- [ ] #13 File is not corrupted (can be opened by media library)
- [ ] #14 Duration > 0 for audio/video

### Error Types
- [ ] #15 `MediaError` union: FileNotFound, UnsupportedFormat, CorruptFile, MetadataExtractionFailed
- [ ] #16 Returns Result[T, MediaError] - explicit error handling

### Implementation
- [ ] #17 Uses ffprobe or similar for audio/video metadata
- [ ] #18 Uses Pillow for image metadata
- [ ] #19 Adapter wraps external tools, provides clean interface
<!-- AC:END -->
