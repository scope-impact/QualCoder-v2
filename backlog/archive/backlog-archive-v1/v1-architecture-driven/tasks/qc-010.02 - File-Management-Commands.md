---
id: QC-010.02
title: File Management Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - sources
  - P0
dependencies: []
parent_task_id: QC-010
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: RenameSource, BulkRenameSource (pattern), DeleteSource (with undo), ExportSource, UpdateSourceMemo. Emit domain events.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `rename_source(source_id, new_name) -> Result[SourceRenamed, RenameError]`
- [ ] #2 `bulk_rename_sources(source_ids, pattern, start_num) -> Result[BulkRenameCompleted, RenameError]`
- [ ] #3 `delete_source(source_id) -> Result[SourceDeleted, DeleteError]`
- [ ] #4 `export_source(source_id, dest_path) -> Result[SourceExported, ExportError]`
- [ ] #5 `update_source_memo(source_id, memo) -> Result[SourceMemoUpdated, UpdateError]`

### Deriver Functions (Pure)
- [ ] #6 `derive_rename_event(source, new_name, existing_names) -> Result[SourceRenamed, RenameError]`
- [ ] #7 `derive_bulk_rename(sources, pattern, start) -> List[Tuple[SourceId, str]]` - generates new names
- [ ] #8 `derive_delete_event(source, has_segments) -> Result[SourceDeleted, DeleteError]`

### Invariants
- [ ] #9 `is_name_unique(name: str, existing: List[str]) -> bool`
- [ ] #10 `is_source_deletable(source_id, segments) -> bool` - warns if has coded segments
- [ ] #11 `is_valid_rename_pattern(pattern: str) -> bool` - must contain {n} placeholder

### Event Publishing
- [ ] #12 On success: persist change → publish domain event → return Result
- [ ] #13 Events: SourceRenamed, SourceDeleted, SourceMemoUpdated, SourceExported

### Undo Support
- [ ] #14 Delete stores source in soft-delete state (can be restored)
- [ ] #15 `restore_source(source_id) -> Result[SourceRestored, RestoreError]` for undo
<!-- AC:END -->
