---
id: QC-005.03
title: Batch Operations
status: To Do
assignee: []
created_date: '2026-01-29 16:38'
labels:
  - infrastructure
  - coding
  - P1
dependencies: []
parent_task_id: QC-005
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Add repository methods for batch segment operations. Required for auto-coding and undo functionality.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Repository Methods (SegmentRepository)
- [ ] #1 `save_batch(segments: List[Segment], batch_id: BatchId) -> List[SegmentId]` - inserts atomically, returns created IDs
- [ ] #2 `delete_by_batch_id(batch_id: BatchId) -> int` - removes all segments in batch, returns count deleted
- [ ] #3 `find_by_batch_id(batch_id: BatchId) -> List[Segment]` - retrieves all segments in a batch

### Batch Tracking
- [ ] #4 `batch_id` column added to segment storage (nullable for non-batch operations)
- [ ] #5 `BatchId` typed identifier following project ID pattern (UUID or int)

### Transaction Support
- [ ] #6 All batch operations wrapped in SQLite transaction (BEGIN/COMMIT/ROLLBACK)
- [ ] #7 On failure, entire batch is rolled back (atomicity guarantee)
- [ ] #8 `with_transaction(fn)` context manager for coordinating multiple operations

### Performance
- [ ] #9 Batch insert uses executemany for efficiency
- [ ] #10 batch_id column indexed for fast deletion/lookup
<!-- AC:END -->
