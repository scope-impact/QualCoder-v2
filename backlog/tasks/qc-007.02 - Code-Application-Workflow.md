---
id: QC-007.02
title: Code Application Workflow
status: Done
assignee: []
created_date: '2026-01-29 16:14'
labels:
  - presentation
  - coding
  - text-coding
  - P0
dependencies: [QC-007.21]
parent_task_id: QC-007
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Implement the core workflow for applying codes to text selections. Wire signals between text selection and code application. Update highlights and code counts on application.

**Note:** This task depends on QC-007.21 (ViewModel Integration) for the signals to actually trigger domain operations.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->

### Keyboard Actions (handlers exist, need viewmodel wiring)
- [x] #1 Apply selected code to text selection via Q key (quick mark)
- [ ] #2 In-vivo coding: create new code from selected text (V key) - deferred to separate task
- [x] #3 Apply code from recent codes submenu (R key)
- [x] #4 Remove code at cursor position (U key - unmark)
- [x] #5 Undo last unmark operation (Ctrl+Z)

### Visual Feedback
- [ ] #6 Visual feedback (flash/highlight) on code application - deferred (signal exists, animation not implemented)
- [ ] #7 Code counts update in tree after apply/remove - deferred (updates via segments_changed signal)

### Signal Definitions (UI layer)
- [x] #8 `text_selected` signal enables code application buttons
- [x] #9 `code_selected` signal sets active code for quick-mark
- [x] #10 `code_applied` signal triggers highlight update

<!-- AC:END -->

## Implementation Notes

**Current State:** Core workflow is complete. Q/U/Ctrl+Z/R keys work end-to-end through the viewmodel to the database. V key (in-vivo) and flash animation are deferred.

## Implementation

- `src/presentation/screens/text_coding.py` - action handlers
- `src/presentation/organisms/text_editor_panel.py` - signals
- `src/presentation/organisms/codes_panel.py` - count updates
