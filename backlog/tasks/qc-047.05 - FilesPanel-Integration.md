---
id: QC-047.05
title: FilesPanel Integration
status: To Do
parent: QC-047
layer: Presentation
created_date: '2026-02-04'
labels: [presentation, coding, refactor, P2]
dependencies: [QC-047.01]
---

## Description

In the target design, the Coding screen shows only the codes panel in the left sidebar—no separate files panel. Files should be selected via the "Files" navigation screen, then the user switches to "Coding" to code the selected file.

**Current State:**
- FilesPanel and CodesPanel are stacked in the left sidebar
- User selects files within the Coding screen

**Target State:**
- Only CodesPanel in Coding screen sidebar
- File selection happens in "Files" screen (FileManagerScreen)
- Current file shown in header area

**Effort Estimate:** 2-6 hours (Low-Medium)

## Acceptance Criteria

- [ ] FilesPanel removed from TextCodingScreen sidebar
- [ ] Only CodesPanel visible in left sidebar of Coding view
- [ ] Current file name displayed in header/toolbar area
- [ ] "Files" navigation opens FileManagerScreen for file selection
- [ ] Selecting file in Files screen + clicking "Coding" opens that file
- [ ] Preserve ability to navigate between files (prev/next in header)
- [ ] No orphan file selection state when switching screens

## Implementation

### Files to Modify

1. **`src/contexts/coding/presentation/screens/text_coding.py`**
   - Remove FilesPanel from layout
   - Add file name display to header area
   - Add prev/next file navigation to header (optional)

2. **`src/contexts/sources/presentation/screens/file_manager.py`**
   - Ensure file selection is persisted/accessible
   - On file double-click: auto-switch to Coding screen

3. **`src/main.py`**
   - Wire file selection from FileManager to TextCoding screen
   - Handle "open file for coding" navigation flow

### Layout Change

**Before:**
```
┌─────────────────────────────────────────┐
│ Toolbar                                 │
├─────────┬───────────────────────────────┤
│ Files   │                               │
│ Panel   │ Editor                        │
├─────────┤                               │
│ Codes   │                               │
│ Panel   │                               │
└─────────┴───────────────────────────────┘
```

**After:**
```
┌─────────────────────────────────────────┐
│ [Text][AV]...  file_name.txt   Search   │  ← file name in header
├─────────┬───────────────────────────────┤
│ CODES   │                               │
│         │ Editor                        │
│ • Edu   │                               │
│ • Fam   │                               │
│         │                               │
└─────────┴───────────────────────────────┘
```

### Header File Display

```python
class CodingHeader(QFrame):
    """Header showing current file info and navigation"""

    prev_clicked = Signal()
    next_clicked = Signal()

    def __init__(self, colors: ColorPalette):
        # Layout: [◀] file_name.txt (123 segments) [▶]

        self._prev_btn = Button("◀", variant="ghost")
        self._file_label = QLabel("No file selected")
        self._stats_label = QLabel("")  # e.g., "8 codes applied"
        self._next_btn = Button("▶", variant="ghost")

    def set_file(self, name: str, stats: str = ""):
        self._file_label.setText(name)
        self._stats_label.setText(stats)
```

### Navigation Flow

```
User in Files screen
    ↓
Selects "interview_01.txt"
    ↓
FileManagerScreen stores selection in AppContext or emits signal
    ↓
User clicks "Coding" in navigation
    ↓
TextCodingScreen loads the selected file
    ↓
Header shows "interview_01.txt | 8 codes applied"
```

### Cross-Screen State

Option A: **AppContext stores selected file**
```python
# In AppContext
class AppContext:
    current_source_id: int | None = None

# FileManager sets it
self._ctx.current_source_id = selected_file.id

# TextCodingScreen reads it
source_id = self._ctx.current_source_id
if source_id:
    self._load_source(source_id)
```

Option B: **Signal-based handoff**
```python
# QualCoderApp wires the connection
self._file_manager.file_selected_for_coding.connect(
    self._text_coding.load_source
)
```

## Technical Notes

### What Happens to FilesPanel?

The `FilesPanel` component (`src/shared/presentation/organisms/files_panel.py`) remains but is only used in `FileManagerScreen`, not in `TextCodingScreen`.

### File Navigation in Coding View

The mockup shows prev/next navigation might not be visible. Options:
1. Add subtle prev/next buttons in header
2. Use keyboard shortcuts (e.g., PageUp/PageDown)
3. Require going back to Files screen

### Edge Cases

- **No file selected:** Show "Select a file from Files" placeholder in editor
- **File deleted while coding:** Handle gracefully, show message
- **Multi-file coding:** If user wants to code multiple files, they switch back to Files

### Migration Path

1. Remove FilesPanel from TextCodingScreen layout
2. Add file name to toolbar/header area
3. Wire FileManagerScreen selection to coding context
4. Test file selection → coding flow
5. Add prev/next navigation (if needed)
