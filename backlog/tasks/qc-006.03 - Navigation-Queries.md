---
id: QC-006.03
title: Navigation Queries
status: To Do
assignee: []
created_date: '2026-01-29 16:38'
labels:
  - application
  - coding
  - P1
dependencies: []
parent_task_id: QC-006
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Implement controller queries for navigating between code instances. Used by prev/next buttons in code tree.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Query Methods (Read Path - CQRS-lite)
- [ ] #1 `get_next_segment(code_id, current_segment_id) -> Optional[SegmentNavigation]`
- [ ] #2 `get_prev_segment(code_id, current_segment_id) -> Optional[SegmentNavigation]`
- [ ] #3 `get_all_segments_for_code(code_id) -> List[SegmentNavigation]`
- [ ] #4 `get_segment_index(code_id, segment_id) -> Tuple[int, int]` - returns (current_index, total_count)

### Query DTO (Read-only, for UI navigation)
- [ ] #5 `SegmentNavigation` DTO: segment_id, source_id, source_name, position (TextPosition | ImageRegion | TimeRange)
- [ ] #6 DTO is frozen dataclass, not domain entity

### Ordering
- [ ] #7 Segments ordered by: source_id ASC, then position.start ASC
- [ ] #8 Ordering consistent across all navigation methods

### Implementation
- [ ] #9 Queries are read-only (no state changes, no events published)
- [ ] #10 Repository method `find_ordered_by_code(code_id)` provides underlying data
- [ ] #11 Navigation logic (next/prev) can be pure function over ordered list
<!-- AC:END -->
