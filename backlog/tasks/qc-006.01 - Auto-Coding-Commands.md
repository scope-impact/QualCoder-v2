---
id: QC-006.01
title: Auto-Coding Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:38'
labels:
  - application
  - coding
  - P1
dependencies: []
parent_task_id: QC-006
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Implement controller commands for auto-coding operations. Find matches and apply codes in batch with undo support.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell - coordinates I/O)
- [ ] #1 `auto_code_exact(code_id, source_id, text, match_type) -> Result[AutoCodeBatchCompleted, Failure]`
- [ ] #2 `auto_code_fragments(code_id, source_id, text, threshold) -> Result[AutoCodeBatchCompleted, Failure]`
- [ ] #3 `mark_speakers(source_id) -> Result[SpeakersMarked, Failure]`
- [ ] #4 `undo_auto_code(batch_id) -> Result[AutoCodeBatchUndone, Failure]`

### Deriver Functions (Pure, in Functional Core)
- [ ] #5 `derive_auto_code_matches(source_text, pattern, match_type) -> List[TextPosition]` - pure text matching
- [ ] #6 `derive_speaker_patterns(source_text) -> List[SpeakerMatch]` - detects "Name:", "[Name]", "{Name}"
- [ ] #7 `derive_batch_segments(matches, code_id, source_id, batch_id) -> List[Segment]` - creates segment entities

### Controller Flow (per fDDD pattern)
- [ ] #8 Controller: fetch state (code, source) → call deriver → persist batch → publish event
- [ ] #9 On deriver failure, return Failure without side effects
- [ ] #10 On success, emit AutoCodeBatchStarted, then AutoCodeBatchCompleted events

### Progress Reporting
- [ ] #11 `progress_callback: Callable[[int, int], None]` optional parameter (current, total)
- [ ] #12 Callback invoked during batch creation for UI progress display
<!-- AC:END -->
