---
id: QC-014.03
title: Case Membership Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - cases
  - P1
dependencies: []
parent_task_id: QC-014
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: AddCaseMember, RemoveCaseMember, AddPartialCaseMember (text segment), AutoAssignByMarkers. Coordinate with Source context.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `add_case_member(case_id, source_id) -> Result[CaseMemberAdded, AddError]` - full source
- [ ] #2 `add_partial_member(case_id, source_id, start, end) -> Result[CaseMemberAdded, AddError]` - text segment
- [ ] #3 `remove_case_member(case_id, source_id) -> Result[CaseMemberRemoved, RemoveError]`
- [ ] #4 `auto_assign_by_markers(case_id, source_id, start_marker, end_marker) -> Result[AutoAssignCompleted, AssignError]`

### Deriver Functions (Pure)
- [ ] #5 `derive_membership(case, source, position, existing) -> Result[CaseMembership, Error]`
- [ ] #6 `find_marker_positions(text, start_marker, end_marker) -> List[TextPosition]` - pure text analysis
- [ ] #7 `derive_partial_memberships(case, source, positions) -> List[CaseMembership]`

### Invariants
- [ ] #8 `is_source_exists(source_id) -> bool`
- [ ] #9 `is_case_exists(case_id) -> bool`
- [ ] #10 `is_membership_unique(case_id, source_id, position) -> bool`
- [ ] #11 `is_position_within_source(position, source) -> bool`

### Cross-Context Coordination
- [ ] #12 Subscribes to SourceCaseLinked/SourceCaseUnlinked events from Source context
- [ ] #13 Updates membership model when Source context emits linking events
- [ ] #14 Follows Published Language pattern - events are the contract

### Event Publishing
- [ ] #15 `CaseMemberAdded` event: case_id, source_id, link_type, position
- [ ] #16 `CaseMemberRemoved` event: case_id, source_id
- [ ] #17 `AutoAssignCompleted` event: case_id, source_id, segments_added
<!-- AC:END -->
