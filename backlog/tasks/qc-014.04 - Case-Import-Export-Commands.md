---
id: QC-014.04
title: Case Import/Export Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - cases
  - P1
dependencies: []
parent_task_id: QC-014
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: ImportCases (from CSV/XLSX), ExportCases (to XLSX). Auto-create attribute types from import headers.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `import_cases(path: Path, mapping: ColumnMapping) -> Result[CasesImported, ImportError]`
- [ ] #2 `export_cases(case_ids: List[CaseId], path: Path) -> Result[ExportCompleted, ExportError]`
- [ ] #3 `preview_import(path: Path) -> Result[ImportPreview, PreviewError]`

### Deriver Functions (Pure)
- [ ] #4 `derive_cases_from_rows(rows, mapping, existing_names, owner) -> List[Case]`
- [ ] #5 `derive_attribute_types_from_headers(headers, name_column, existing_types) -> List[AttributeType]`
- [ ] #6 `derive_attribute_values(rows, mapping, cases) -> Dict[CaseId, Dict[AttributeTypeId, str]]`

### Import Flow
- [ ] #7 Parse file → preview → auto-detect/map columns → create AttributeTypes → create Cases → set values
- [ ] #8 Duplicate case names: append suffix (e.g., "Case (2)")
- [ ] #9 Progress callback for large files

### Export Flow
- [ ] #10 Fetch cases and attributes → generate XLSX with headers → format columns → save
- [ ] #11 Default filename suggestion: `{project_name}_cases_{date}.xlsx`

### Auto-Create Attribute Types
- [ ] #12 Headers not mapped to existing types create new AttributeTypes
- [ ] #13 Infer ValueType from column content (numeric, date, character)

### Event Publishing
- [ ] #14 `CasesImported` event: case_ids, attribute_types_created, row_count
- [ ] #15 Individual CaseCreated events for each case (enables UI update)

### Error Handling
- [ ] #16 `ImportError` union: FileNotFound, InvalidFormat, DuplicateName, EncodingError
- [ ] #17 `ExportError` union: FileNotWritable, DiskFull
<!-- AC:END -->
