---
id: QC-017.01
title: Report Query Engines
status: To Do
assignee: []
created_date: '2026-01-29 16:42'
labels:
  - infrastructure
  - analysis
  - P0
dependencies: []
parent_task_id: QC-017
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Query engines: FrequencyQueryEngine, CoOccurrenceQueryEngine, CoderComparisonEngine. Execute reports with filter specifications.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Query Engine Interfaces
- [ ] #1 `FrequencyQueryEngine.execute(filters: ReportFilters) -> FrequencyReport`
- [ ] #2 `CoOccurrenceQueryEngine.execute(filters: ReportFilters, mode: OverlapMode) -> CoOccurrenceMatrix`
- [ ] #3 `CoderComparisonEngine.execute(coder_a, coder_b, filters) -> CoderComparisonReport`

### Implementation (Infrastructure Layer)
- [ ] #4 Engines query repositories, never modify state (read-only)
- [ ] #5 Use optimized SQL queries for aggregations (not in-memory)
- [ ] #6 Return frozen value objects (immutable reports)

### FrequencyQueryEngine
- [ ] #7 Groups segments by code, counts per code
- [ ] #8 Calculates percentages relative to total
- [ ] #9 Supports grouping by: code, category, coder, source

### CoOccurrenceQueryEngine
- [ ] #10 `OverlapMode` enum: OVERLAPPING (same position), EDGE_CONNECTED (adjacent)
- [ ] #11 Builds code Ã— code matrix efficiently
- [ ] #12 Symmetric matrix: cell[a,b] == cell[b,a]

### CoderComparisonEngine
- [ ] #13 Calculates Cohen's Kappa for two coders
- [ ] #14 Identifies agreement/disagreement segments
- [ ] #15 Returns detailed comparison with per-code breakdown

### Performance
- [ ] #16 Optimized for large datasets (100k+ segments)
- [ ] #17 Supports progress callback for long-running queries
<!-- AC:END -->
