---
id: QC-010.05
title: Survey Import Command
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - sources
  - P2
dependencies: []
parent_task_id: QC-010
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Command: ImportSurvey. Parse CSV with configured delimiter, map columns to attributes, collate text responses into sources.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Command (Imperative Shell)
- [ ] #1 `import_survey(path: Path, config: SurveyConfig) -> Result[SurveyImported, ImportError]`
- [ ] #2 `preview_survey(path: Path, config: SurveyConfig, rows: int = 10) -> Result[SurveyPreview, PreviewError]`

### Deriver Functions (Pure)
- [ ] #3 `derive_sources_from_survey(rows, config, owner) -> List[Source]` - creates Source entities
- [ ] #4 `derive_cases_from_survey(rows, config, owner) -> List[Case]` - creates Case entities if configured
- [ ] #5 `derive_attributes_from_columns(columns, config) -> List[AttributeType]` - auto-creates types

### Collation Modes
- [ ] #6 `PER_COLUMN`: Each text column becomes a separate source
- [ ] #7 `PER_ROW`: Each row becomes a source (concatenated text columns)
- [ ] #8 `SINGLE`: All text collated into single source

### Cross-Context Coordination
- [ ] #9 Creates Cases from identifier column (if configured)
- [ ] #10 Creates AttributeTypes in Case context (if attribute columns mapped)
- [ ] #11 Links Sources to Cases based on row correspondence

### Event Publishing
- [ ] #12 `SurveyImported` event: source_ids, case_ids (if created), attribute_types_created, row_count
- [ ] #13 Individual SourceImported events for each created source

### Progress Reporting
- [ ] #14 `progress_callback: Optional[Callable[[int, int], None]]` - (rows_processed, total_rows)
- [ ] #15 Streaming processing for large files (>100MB)
<!-- AC:END -->
