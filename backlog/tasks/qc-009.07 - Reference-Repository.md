---
id: QC-009.07
title: Reference Repository
status: To Do
assignee: []
created_date: '2026-01-30'
labels:
  - infrastructure
  - sources
  - bibliography
  - P3
dependencies: [QC-008.05]
parent_task_id: QC-009
---

## Description

Repository and RIS importer for bibliographic References.

## Original QualCoder Reference

- Tables: `refs`, `source_refs` (linking table)
- Module: `ris.py` for RIS parsing

## Acceptance Criteria

### ReferenceRepository Interface
- [ ] #1 `create(reference: Reference) -> ReferenceId`
- [ ] #2 `get_by_id(id: ReferenceId) -> Reference | None`
- [ ] #3 `get_all() -> list[Reference]`
- [ ] #4 `get_by_file(file_id: int) -> list[Reference]`
- [ ] #5 `update(reference: Reference) -> None`
- [ ] #6 `delete(id: ReferenceId) -> None`
- [ ] #7 `link_to_file(ref_id, file_id) -> None`
- [ ] #8 `unlink_from_file(ref_id, file_id) -> None`
- [ ] #9 `get_files_for_reference(ref_id) -> list[int]`

### RISImporter Service
- [ ] #10 `parse_ris_file(path) -> list[Reference]`
- [ ] #11 Map RIS tags to Reference fields (using rispy TAG_KEY_MAPPING)
- [ ] #12 Handle multiple reference types
- [ ] #13 `detect_duplicates(references) -> list[tuple[Reference, Reference]]`

### SQLite Implementation
- [ ] #14 `refs` table with all fields
- [ ] #15 `source_refs` linking table (fid, refid)

## Implementation

- `src/infrastructure/source/reference_repository.py`
- `src/infrastructure/source/ris_importer.py`

## Database Schema

```sql
CREATE TABLE refs (
    refid INTEGER PRIMARY KEY,
    reftype TEXT,
    authors TEXT,  -- JSON array
    title TEXT,
    year INTEGER,
    journal TEXT,
    volume TEXT,
    issue TEXT,
    pages TEXT,
    doi TEXT,
    url TEXT,
    keywords TEXT,  -- JSON array
    abstract TEXT
);

CREATE TABLE source_refs (
    id INTEGER PRIMARY KEY,
    fid INTEGER REFERENCES source(id),
    refid INTEGER REFERENCES refs(refid)
);
```
