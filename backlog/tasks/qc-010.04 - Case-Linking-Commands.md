---
id: QC-010.04
title: Case Linking Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - sources
  - P1
dependencies: []
parent_task_id: QC-010
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: LinkSourceToCase, UnlinkSourceFromCase, BulkLinkSources. Cross-context command coordinating with Cases domain.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `link_source_to_case(source_id, case_id, position: Optional[TextPosition]) -> Result[SourceCaseLinked, LinkError]`
- [ ] #2 `unlink_source_from_case(source_id, case_id) -> Result[SourceCaseUnlinked, UnlinkError]`
- [ ] #3 `bulk_link_sources(source_ids: List[SourceId], case_id) -> Result[BulkLinkCompleted, LinkError]`

### Deriver Functions (Pure)
- [ ] #4 `derive_link_event(source, case, position) -> Result[SourceCaseLinked, LinkError]`
- [ ] #5 `derive_partial_link(source, case, start, end) -> Result[SourceCaseLinked, LinkError]` - partial text

### Invariants
- [ ] #6 `is_source_exists(source_id) -> bool`
- [ ] #7 `is_case_exists(case_id) -> bool`
- [ ] #8 `is_link_unique(source_id, case_id) -> bool` - not already linked
- [ ] #9 `is_position_valid(position, source) -> bool` - for partial links

### Cross-Context Coordination (Published Language)
- [ ] #10 Source context emits `SourceCaseLinked` / `SourceCaseUnlinked` events
- [ ] #11 Case context subscribes to these events to update its membership model
- [ ] #12 Events form the contract between Source and Case bounded contexts

### Event Structure
- [ ] #13 `SourceCaseLinked` event: source_id, case_id, link_type (FULL|PARTIAL), position (optional)
- [ ] #14 `SourceCaseUnlinked` event: source_id, case_id

### Partial Linking
- [ ] #15 Partial link stores TextPosition (start, end) for text segment of source
- [ ] #16 Full link has position = None (entire source linked)
<!-- AC:END -->
