---
id: QC-006.08
title: Recent Codes Service
status: To Do
assignee: []
created_date: '2026-01-29 16:38'
labels:
  - application
  - coding
  - P2
dependencies: [QC-006.01, QC-006.05]
parent_task_id: QC-006
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Track and query recently used codes. Updates on code application, returns last N codes used.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Service Interface
- [ ] #1 `RecentCodesService` - tracks and queries recently used codes
- [ ] #2 `get_recent_codes(limit: int = 10) -> List[Code]` - returns most recently used codes
- [ ] #3 `clear_recent_codes() -> None` - resets recent codes list

### Event-Driven Tracking (Policy Pattern)
- [ ] #4 `on_segment_coded(event: SegmentCoded)` - policy updates recency for event.code_id
- [ ] #5 Policy subscribes to SegmentCoded events via EventBus
- [ ] #6 Pure function: `record_usage(code_id, timestamp)` - no side effects in core

### Persistence (Infrastructure)
- [ ] #7 Stored via `last_used_at` column in CodeRepository (see QC-005.04)
- [ ] #8 Persists across sessions automatically via SQLite

### Query (Read Path)
- [ ] #9 Query uses `CodeRepository.find_recent(limit)` method
- [ ] #10 Returns frozen Code entities (immutable)
- [ ] #11 Excludes deleted codes automatically

### Integration
- [ ] #12 Service is Application layer component
- [ ] #13 UI calls service for quick-access code list
- [ ] #14 Agent can also query recent codes for context
<!-- AC:END -->
