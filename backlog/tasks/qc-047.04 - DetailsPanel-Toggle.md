---
id: QC-047.04
title: DetailsPanel Toggle
status: To Do
parent: QC-047
layer: Presentation
created_date: '2026-02-04'
labels: [presentation, coding, refactor, P2]
dependencies: [QC-047.03]
---

## Description

Make DetailsPanel collapsible via the "Show Details" toggle button in the toolbar. Currently always visible; should hide/show on toggle.

**Current State:** DetailsPanel is always visible in the right panel of the three-panel layout.

**Target State:** DetailsPanel visibility controlled by "Show Details" button. Hidden by default (more transcript space).

**Effort Estimate:** 2-4 hours (Low)

## Acceptance Criteria

- [ ] DetailsPanel hidden by default on screen load
- [ ] "Show Details" button click shows the panel
- [ ] "Hide Details" button click hides the panel
- [ ] Panel animates smoothly (optional: slide in/out)
- [ ] Transcript area expands when panel hidden
- [ ] Panel state persists during session (optional: across sessions)
- [ ] All existing DetailsPanel content preserved when visible

## Implementation

### Files to Modify

1. **`src/shared/presentation/organisms/details_panel.py`** (413 lines)
   - Add `set_visible()` method with optional animation
   - Ensure clean show/hide behavior

2. **`src/contexts/coding/presentation/screens/text_coding.py`**
   - Connect toolbar's `details_toggle_clicked` to panel visibility
   - Update layout to handle panel visibility changes

3. **`src/shared/presentation/templates/layouts/three_panel.py`**
   - Ensure right panel can be hidden and center panel expands

### Signal Wiring

```python
# In TextCodingScreen or TextCodingPage

def _setup_connections(self):
    # Connect toolbar toggle to panel visibility
    self._toolbar.details_toggle_clicked.connect(self._toggle_details_panel)

def _toggle_details_panel(self):
    """Toggle details panel visibility"""
    is_visible = self._details_panel.isVisible()
    self._details_panel.setVisible(not is_visible)
    self._toolbar.set_details_visible(not is_visible)

    # Optionally adjust layout stretch
    if is_visible:
        # Panel hiding - give more space to editor
        self._layout.setStretch(1, 1)  # Editor gets all flex
        self._layout.setStretch(2, 0)  # Panel gets none
    else:
        # Panel showing - restore proportions
        self._layout.setStretch(1, 3)  # Editor
        self._layout.setStretch(2, 1)  # Panel
```

### Animation (Optional)

```python
from PySide6.QtCore import QPropertyAnimation, QEasingCurve

class DetailsPanel(QFrame):
    def __init__(self, ...):
        self._animation = QPropertyAnimation(self, b"maximumWidth")
        self._animation.setDuration(200)
        self._animation.setEasingCurve(QEasingCurve.Type.OutCubic)

    def animate_show(self):
        self._animation.setStartValue(0)
        self._animation.setEndValue(300)  # Target width
        self._animation.start()
        self.show()

    def animate_hide(self):
        self._animation.setStartValue(self.width())
        self._animation.setEndValue(0)
        self._animation.finished.connect(self.hide)
        self._animation.start()
```

## Technical Notes

### Layout Behavior

When panel is hidden:
```
┌─────────┬─────────────────────────────────┐
│ CODES   │ Transcript content...           │
│         │ (expands to fill space)         │
│         │                                 │
└─────────┴─────────────────────────────────┘
```

When panel is visible:
```
┌─────────┬───────────────────────┬─────────┐
│ CODES   │ Transcript...         │ Details │
│         │                       │ Panel   │
│         │                       │         │
└─────────┴───────────────────────┴─────────┘
```

### State Persistence (Optional)

```python
# Save to settings
def _toggle_details_panel(self):
    is_visible = not self._details_panel.isVisible()
    self._details_panel.setVisible(is_visible)
    self._settings.setValue("coding/details_panel_visible", is_visible)

# Restore on load
def _restore_layout(self):
    visible = self._settings.value("coding/details_panel_visible", False, type=bool)
    self._details_panel.setVisible(visible)
    self._toolbar.set_details_visible(visible)
```

### Default State

Per the mockup, the panel is likely hidden by default (showing "Show Details" button). This gives maximum space to the transcript.

```python
def __init__(self):
    # ...
    self._details_panel.setVisible(False)  # Hidden by default
    self._toolbar.set_details_visible(False)
```
