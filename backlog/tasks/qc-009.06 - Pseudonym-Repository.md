---
id: QC-009.06
title: Pseudonym Repository
status: To Do
assignee: []
created_date: '2026-01-30'
labels:
  - infrastructure
  - sources
  - privacy
  - P2
dependencies: [QC-008.04]
parent_task_id: QC-009
---

## Description

Repository and services for Pseudonym persistence and application.

## Original QualCoder Reference

- Storage: `pseudonyms.json` file in project folder

## Acceptance Criteria

### PseudonymRepository Interface
- [ ] #1 `get_all() -> list[PseudonymMapping]`
- [ ] #2 `add(mapping: PseudonymMapping) -> Result[None, DuplicateError]`
- [ ] #3 `delete(original: str) -> Result[None, NotFoundError]`
- [ ] #4 `find_by_original(original: str) -> PseudonymMapping | None`
- [ ] #5 `find_by_pseudonym(pseudonym: str) -> PseudonymMapping | None`

### JSON Implementation
- [ ] #6 Load from `{project_path}/pseudonyms.json`
- [ ] #7 Save on each modification
- [ ] #8 Handle missing file (create empty)

### PseudonymService
- [ ] #9 `apply_to_file(file_id) -> int` (returns replacement count)
- [ ] #10 `apply_to_all_files() -> dict[int, int]` (file_id â†’ count)
- [ ] #11 `preview_replacements(file_id) -> list[tuple[str, str, int]]` (original, pseudonym, position)

### Safety
- [ ] #12 Backup file before applying pseudonyms
- [ ] #13 Transaction-wrapped file updates

## Implementation

- `src/infrastructure/source/pseudonym_repository.py`
- `src/infrastructure/source/pseudonym_service.py`

## Storage Format

```json
{
  "mappings": [
    {"original": "John Smith", "pseudonym": "Participant A", "created": "2026-01-30"}
  ]
}
```
