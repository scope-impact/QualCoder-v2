---
id: QC-020.02
title: Agent Statistics Service
status: To Do
assignee: []
created_date: '2026-01-29 16:43'
labels:
  - application
  - ai-assistant
  - P0
dependencies: []
parent_task_id: QC-020
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
AgentStatisticsService: track actions/minute, approval rate, rejection rate, session totals. Real-time metrics emission.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Statistics Value Objects (frozen dataclasses)
- [ ] #1 `AgentStatistics`: actions_total, actions_per_minute, approval_rate, rejection_rate, session_duration
- [ ] #2 `ActionMetrics`: tool_name, count, avg_duration_ms, success_rate
- [ ] #3 Immutable - recalculated on each query

### AgentStatisticsService Interface
- [ ] #4 `record_action(action: AgentAction) -> None` - logs action for stats
- [ ] #5 `get_current_statistics() -> AgentStatistics` - real-time stats
- [ ] #6 `get_statistics_for_period(start, end) -> AgentStatistics` - historical
- [ ] #7 `get_per_tool_metrics() -> Dict[str, ActionMetrics]`

### Event-Driven Updates
- [ ] #8 Subscribes to SuggestionApproved/Rejected events
- [ ] #9 Updates metrics on each action completion
- [ ] #10 Emits `StatisticsUpdated` event on significant changes

### Pure Calculation Functions
- [ ] #11 `calculate_rate(count, total) -> float` - pure percentage
- [ ] #12 `calculate_actions_per_minute(actions, duration) -> float`

### Persistence
- [ ] #13 Session statistics persisted to SQLite for history
- [ ] #14 Real-time metrics computed from in-memory state
<!-- AC:END -->
