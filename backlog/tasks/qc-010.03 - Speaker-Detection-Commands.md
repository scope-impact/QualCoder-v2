---
id: QC-010.03
title: Speaker Detection Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - sources
  - P1
dependencies: []
parent_task_id: QC-010
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: DetectSpeakers (extract from transcript), CreateSpeakerCodes (create codes for speakers). Support multiple speaker formats.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `detect_speakers(source_id, format: SpeakerFormat = AUTO) -> Result[SpeakersDetected, DetectionError]`
- [ ] #2 `create_speaker_codes(source_id, speakers: List[Speaker]) -> Result[SpeakerCodesCreated, CreateError]`
- [ ] #3 `detect_and_create_speakers(source_id) -> Result[SpeakerCodesCreated, Error]` - combined operation

### Deriver Functions (Pure, in Functional Core)
- [ ] #4 `detect_speakers(text: str, format: SpeakerFormat) -> List[SpeakerMatch]` - pure text analysis
- [ ] #5 `derive_speaker_codes(speakers: List[Speaker], owner) -> List[Code]` - creates Code entities
- [ ] #6 `assign_speaker_colors(speakers: List[str]) -> Dict[str, Color]` - auto-assigns distinct colors

### Speaker Detection (Pure Functions)
- [ ] #7 Detects patterns: "Name:" (colon), "[Name]" (bracket), "{Name}" (brace)
- [ ] #8 AUTO format tries all patterns, uses most frequent
- [ ] #9 Returns speaker names with occurrence count and positions

### Cross-Context Coordination
- [ ] #10 Creates "Speakers" category in Coding context if not exists
- [ ] #11 Creates Code for each speaker with auto-assigned color
- [ ] #12 Emits SpeakersDetected event (Source context) + CodeCreated events (Coding context)

### Event Publishing
- [ ] #13 `SpeakersDetected` event: source_id, speakers (list), format_used
- [ ] #14 `SpeakerCodesCreated` event: source_id, code_ids (list), category_id
<!-- AC:END -->
