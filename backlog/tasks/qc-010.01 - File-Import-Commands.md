---
id: QC-010.01
title: File Import Commands
status: To Do
assignee: []
created_date: '2026-01-29 16:41'
labels:
  - application
  - sources
  - P0
dependencies: []
parent_task_id: QC-010
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Commands: ImportFile (copy), ImportLinkedFile (reference), ImportFolder (batch). Handle encoding detection, duplicate check, progress reporting.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Controller Commands (Imperative Shell)
- [ ] #1 `import_file(path: Path, copy: bool = True) -> Result[SourceImported, ImportError]`
- [ ] #2 `import_linked_file(path: Path) -> Result[SourceImported, ImportError]` - reference only
- [ ] #3 `import_folder(folder: Path, recursive: bool) -> Result[BatchImportCompleted, ImportError]`

### Deriver Functions (Pure, in Functional Core)
- [ ] #4 `derive_source_entity(path, source_type, encoding, owner) -> Result[Source, ImportError]`
- [ ] #5 `derive_import_decision(file_size, is_media) -> ImportMode` - COPY or LINK

### Import Flow (per fDDD pattern)
- [ ] #6 Controller: validate file → detect type → detect encoding → call deriver → persist → publish event
- [ ] #7 On success: emit SourceImported event with source_id, source_type, path
- [ ] #8 On failure: return ImportError without side effects

### Validation (Invariants)
- [ ] #9 `is_supported_file_type(path: Path) -> bool`
- [ ] #10 `is_duplicate_filename(name: str, existing: List[str]) -> bool`
- [ ] #11 `is_file_accessible(path: Path) -> bool` - readable, not locked

### Progress Reporting
- [ ] #12 `progress_callback: Optional[Callable[[int, int, str], None]]` - (current, total, filename)
- [ ] #13 Callback invoked per file during folder import

### Error Handling
- [ ] #14 `ImportError` union: FileNotFound, UnsupportedFormat, DuplicateName, EncodingError, DiskFull
- [ ] #15 Returns Result[T, ImportError] - explicit error values, no exceptions
<!-- AC:END -->
