---
id: QC-003.01
title: Base Signal Bridge Infrastructure
status: To Do
assignee: []
created_date: '2026-01-29'
labels:
  - application
  - foundation
  - P0
dependencies: []
parent_task_id: QC-003
milestone: M-001
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Create the foundational Signal Bridge infrastructure that all context-specific bridges (Coding, Source, Case, Agent, Collaboration) will inherit from. This establishes the thread-safe pattern for bridging domain events to UI signals.
<!-- SECTION:DESCRIPTION:END -->

## Rationale

All 5 context-specific Signal Bridges share:
- Singleton pattern
- Thread-safe emission (domain events may arrive from background threads)
- Event Bus subscription
- Event → Payload conversion

Extracting this to a base class reduces duplication and ensures consistent behavior.

## Acceptance Criteria
<!-- AC:BEGIN -->

### BaseSignalBridge Class
- [ ] #1 Abstract base class for all signal bridges
- [ ] #2 Singleton pattern with `instance()` class method
- [ ] #3 Class-level registry for singleton instances

### Thread-Safe Emission
- [ ] #4 Method to handle cross-thread signal emission
- [ ] #5 Ensures signals emitted from background threads are delivered on UI thread
- [ ] #6 Detects if already on UI thread → emit directly (optimization)
- [ ] #7 Helper method to check current thread

### Event Bus Integration
- [ ] #8 Accepts event bus as dependency
- [ ] #9 Abstract method for subclasses to define event subscriptions
- [ ] #10 Cleanup method to unsubscribe on destruction
- [ ] #11 Dispatcher method that receives domain events and routes to converters

### Converter Registry Pattern
- [ ] #12 `EventConverter` protocol: converts domain event to UI payload
- [ ] #13 Registry mapping event_type → converter
- [ ] #14 Method to register converters
- [ ] #15 Subclasses register their converters during initialization

### Signal Mapping
- [ ] #16 Registry mapping event_type → UI signal
- [ ] #17 Method to register signal mappings
- [ ] #18 Auto-wiring: event arrives → convert → emit mapped signal

### Activity Feed Integration
- [ ] #19 Common signal for activity logging (all bridges emit here)
- [ ] #20 Method to format and emit activity items
- [ ] #21 `ActivityItem` type with timestamp, session_id, description, status

### Lifecycle Management
- [ ] #22 `start()` - begin listening to events
- [ ] #23 `stop()` - stop listening, cleanup subscriptions
- [ ] #24 Context manager support for automatic cleanup

### Payload DTOs
- [ ] #25 `SignalPayload` base type (immutable)
- [ ] #26 Common fields: `timestamp`, `session_id`, `is_ai_action`, `event_type`
- [ ] #27 `ActivityItem` type for activity feed
- [ ] #28 `ActivityStatus` enum: COMPLETED, PENDING, QUEUED, REJECTED, FAILED

<!-- AC:END -->

## Implementation Notes

**For PyQt6 implementation:**
- Base class inherits from `QObject`
- Signals use `pyqtSignal(object)`
- Thread-safe emission via `QMetaObject.invokeMethod` with `Qt.QueuedConnection`
- Main thread detection via `QThread.currentThread()`

## File Structure

```
src/
├── application/
│   └── signal_bridge/
│       ├── __init__.py
│       ├── base.py              # BaseSignalBridge class
│       ├── protocols.py         # EventConverter protocol
│       ├── payloads.py          # SignalPayload, ActivityItem
│       └── thread_utils.py      # Thread detection helpers
```

## Downstream Tasks

This task unblocks and simplifies:
- QC-006.04 - Signal Bridge (Coding)
- QC-010.06 - Source Signal Bridge
- QC-014.05 - Case Signal Bridge
- QC-020.06 - Agent Signal Bridge
- QC-024.05 - Collaboration Signal Bridge

## Testing Strategy

- [ ] Unit test thread-safe emission (mock UI thread)
- [ ] Unit test converter registry
- [ ] Unit test signal mapping
- [ ] Integration test with real EventBus
- [ ] Verify singleton behavior across imports
