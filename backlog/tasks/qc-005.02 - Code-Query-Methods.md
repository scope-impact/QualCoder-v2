---
id: QC-005.02
title: Code Query Methods
status: To Do
assignee: []
created_date: '2026-01-29 16:38'
labels:
  - infrastructure
  - coding
  - P0
dependencies: []
parent_task_id: QC-005
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Add repository methods for querying codes with counts, searching, and tracking recent usage. Required for code tree display.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### Repository Methods (CodeRepository)
- [ ] #1 `find_all_with_counts() -> List[CodeWithCount]` - returns all codes with segment count, single query
- [ ] #2 `find_by_name_like(pattern: str) -> List[Code]` - case-insensitive search by name pattern
- [ ] #3 `find_recent(limit: int = 10) -> List[Code]` - returns recently used codes, ordered by last_used_at desc
- [ ] #4 `find_by_category_id(category_id: Optional[CategoryId]) -> List[Code]` - None returns uncategorized codes

### Query DTOs (Read-only, for UI display)
- [ ] #5 `CodeWithCount` DTO: code_id, name, color, memo, category_id, segment_count
- [ ] #6 `CodeTreeNode` DTO: code_id, name, color, category_path, segment_count (for tree display)

### Category Queries
- [ ] #7 `find_all_categories_with_codes() -> List[CategoryWithCodes]` - hierarchical structure for tree
- [ ] #8 `find_category_path(category_id) -> List[Category]` - returns ancestor chain for breadcrumb

### Immutability
- [ ] #9 All returned entities are frozen dataclasses
- [ ] #10 Query methods are read-only, never modify state
<!-- AC:END -->
