---
id: QC-006.07
title: Event Converters
status: To Do
assignee: []
created_date: '2026-01-30'
labels:
  - application
  - coding
  - signal-bridge
  - P0
dependencies: [QC-006.06]
parent_task_id: QC-006
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Implement converters that transform domain events into signal payloads. One converter per event type. Converters are pure functions that map domain types to UI-friendly primitives.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->

### Converter Protocol
- [ ] #1 `EventConverter[E, P]` protocol: `convert(event: E) -> P`
- [ ] #2 Converters are stateless (pure transformation)
- [ ] #3 Each converter handles one event type

### Code Event Converters
- [ ] #4 `CodeCreatedConverter`: CodeCreated → CodeCreatedPayload
- [ ] #5 `CodeRenamedConverter`: CodeRenamed → CodeRenamedPayload
- [ ] #6 `CodeDeletedConverter`: CodeDeleted → CodeDeletedPayload
- [ ] #7 `CodeColorChangedConverter`: CodeColorChanged → CodeColorChangedPayload
- [ ] #8 `CodesMergedConverter`: CodesMerged → CodesMergedPayload
- [ ] #9 `CodeMovedToCategoryConverter`: CodeMovedToCategory → CodeMovedToCategoryPayload

### Category Event Converters
- [ ] #10 `CategoryCreatedConverter`: CategoryCreated → CategoryCreatedPayload
- [ ] #11 `CategoryDeletedConverter`: CategoryDeleted → CategoryDeletedPayload
- [ ] #12 `CategoryRenamedConverter`: CategoryRenamed → CategoryRenamedPayload
- [ ] #13 `CategoryMovedConverter`: CategoryMoved → CategoryMovedPayload

### Segment Event Converters
- [ ] #14 `SegmentCodedConverter`: SegmentCoded → SegmentCodedPayload
- [ ] #15 `SegmentUncodedConverter`: SegmentUncoded → SegmentUncodedPayload
- [ ] #16 `ImageSegmentCodedConverter`: ImageSegmentCoded → ImageSegmentCodedPayload
- [ ] #17 `AVSegmentCodedConverter`: AVSegmentCoded → AVSegmentCodedPayload
- [ ] #18 `SegmentMemoUpdatedConverter`: SegmentMemoUpdated → SegmentMemoUpdatedPayload
- [ ] #19 `SegmentImportanceSetConverter`: SegmentImportanceSet → SegmentImportanceSetPayload

### Batch Event Converters
- [ ] #20 `AutoCodeBatchCompletedConverter`: AutoCodeBatchCompleted → AutoCodeBatchCompletedPayload
- [ ] #21 `AutoCodeBatchUndoneConverter`: AutoCodeBatchUndone → AutoCodeBatchUndonePayload

### Conversion Logic
- [ ] #22 Convert CodeId → str via `str(code_id)`
- [ ] #23 Convert Color → str via `color.to_hex()`
- [ ] #24 Convert CoderId → owner_name via coder lookup (or embed name in event)
- [ ] #25 Convert datetime → str via `.isoformat()`
- [ ] #26 Handle Optional fields (None → None)

### Converter Registry
- [ ] #27 `ConverterRegistry` class maps event_type → converter instance
- [ ] #28 `register(event_type: str, converter: EventConverter)` method
- [ ] #29 `get_converter(event_type: str) -> EventConverter | None` method
- [ ] #30 `convert(event: DomainEvent) -> SignalPayload` convenience method

### Testing
- [ ] #31 Each converter has unit tests
- [ ] #32 Tests verify all fields are correctly mapped
- [ ] #33 Tests verify Optional handling (None cases)

<!-- AC:END -->

## Implementation Notes

**Converter Example:**
```python
class CodeCreatedConverter(EventConverter[CodeCreated, CodeCreatedPayload]):
    def convert(self, event: CodeCreated) -> CodeCreatedPayload:
        return CodeCreatedPayload(
            timestamp=event.occurred_at.isoformat(),
            code_id=str(event.code_id),
            name=event.name,
            color_hex=event.color.to_hex(),
            category_id=str(event.category_id) if event.category_id else None,
            owner_name=event.owner_name,  # Assume embedded in event
        )
```

**Registry Usage in SignalBridge:**
```python
class CodingSignalBridge(BaseSignalBridge):
    def __init__(self, event_bus: EventBus, registry: ConverterRegistry):
        self._registry = registry
        event_bus.subscribe_all(self._on_event)

    def _on_event(self, event: DomainEvent) -> None:
        payload = self._registry.convert(event)
        signal = self._get_signal_for_event(event)
        signal.emit(payload)
```

## Files

- `src/application/signal_bridge/coding_converters.py`
- `src/application/signal_bridge/converter_registry.py`
