---
id: QC-027.12
title: Agent Add Text Source
status: To Do
assignee: []
created_date: '2026-02-05 10:00'
labels:
  - interface
  - sources
  - agent-tools
  - P1
dependencies:
  - QC-027.08
parent_task_id: QC-027
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
As an AI Agent, I want to add a text source to the current project so that I can programmatically ingest research data without requiring the researcher to manually import files.

This fills the **F-002.8 gap** identified in the backlog: "Agent cannot add sources." The agent provides text content (and optional metadata), the system creates a new source entry with extracted fulltext, and publishes a `SourceAdded` domain event.

**Trust Level:** T3 (Suggest) — Agent proposes, researcher approves. The agent submits source content; the system can either auto-add (for trusted workflows) or queue for approval.

**Bounded Context:** Sources
**Layer:** Interface (MCP tool) → calls existing `add_source` command handler
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 MCP tool `add_text_source` is registered in ProjectTools with proper schema
- [ ] #2 Agent can provide source name, text content, and optional memo/origin metadata
- [ ] #3 Duplicate source names are rejected with a clear failure message
- [ ] #4 Source is persisted via `add_source` command handler and `SourceAdded` event is published
- [ ] #5 Tool returns the new source ID, name, type, and status on success
- [ ] #6 Empty name or empty content is rejected with validation error
- [ ] #7 E2E test exists with `@allure.story("QC-027.12 Agent Add Text Source")` decorator
- [ ] #8 Tool schema includes inputSchema with required (name, content) and optional (memo, origin) parameters
<!-- AC:END -->

## Implementation

### Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `src/contexts/projects/interface/mcp_tools.py` | Modify | Add `add_text_source` tool definition and handler |
| `src/tests/e2e/test_agent_add_source_e2e.py` | Create | E2E test for agent add source |

### MCP Tool Schema

```json
{
  "name": "add_text_source",
  "description": "Add a new text source to the current project. Provide a name and text content. Optionally include memo and origin metadata.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "name": {
        "type": "string",
        "description": "Name for the new source (must be unique within project)"
      },
      "content": {
        "type": "string",
        "description": "The full text content of the source"
      },
      "memo": {
        "type": "string",
        "description": "Optional memo/notes about the source"
      },
      "origin": {
        "type": "string",
        "description": "Optional origin description (e.g., 'interview transcript', 'field notes')"
      }
    },
    "required": ["name", "content"]
  }
}
```

### Domain Flow

```
add_text_source(name, content, memo?, origin?)
  → validate name uniqueness (invariant)
  → derive SourceAdded or SourceNotAdded event
  → persist Source entity via SourceRepository
  → publish SourceAdded event to EventBus
  → return Success({source_id, name, type: "text", status: "ready"})
```

## Notes

- Reuses existing `add_source` command handler from `src/contexts/sources/core/commandHandlers/add_source.py`
- Source type is always `TEXT` for this tool; file-based imports (PDF, image, media) are handled by separate tools
- The `sources/interface/` directory is currently empty — this tool lives in `projects/interface/mcp_tools.py` alongside other MCP tools for consistency
