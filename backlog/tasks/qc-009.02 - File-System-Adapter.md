---
id: QC-009.02
title: File System Adapter
status: To Do
assignee: []
created_date: '2026-01-29 16:40'
labels:
  - infrastructure
  - sources
  - P0
dependencies: []
parent_task_id: QC-009
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
FileSystemAdapter: copy_to_project, link_external, detect_encoding, check_duplicate, validate_file_type, export_file. Handle large files (>2GB) with linking.
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
### FileSystemAdapter Interface (Infrastructure Adapter)
- [ ] #1 `copy_to_project(source_path: Path, project_dir: Path) -> Result[Path, FileError]`
- [ ] #2 `link_external(source_path: Path) -> Result[Path, FileError]` - stores path reference only
- [ ] #3 `export_file(source: Source, dest_path: Path) -> Result[Path, FileError]`
- [ ] #4 `delete_file(path: Path) -> Result[None, FileError]`

### Validation Methods
- [ ] #5 `detect_encoding(path: Path) -> Encoding` - returns UTF-8, Latin-1, etc.
- [ ] #6 `check_duplicate(filename: str, project_dir: Path) -> bool` - true if name exists
- [ ] #7 `validate_file_type(path: Path) -> Result[SourceType, UnsupportedFormat]`
- [ ] #8 `get_file_size(path: Path) -> int` - returns bytes

### Large File Handling
- [ ] #9 Files > 2GB automatically linked (not copied)
- [ ] #10 `LARGE_FILE_THRESHOLD = 2 * 1024 * 1024 * 1024` constant
- [ ] #11 `should_link(path: Path) -> bool` - true if size > threshold

### Result Types (Explicit Effects)
- [ ] #12 `FileError` union type: FileNotFound, PermissionDenied, DiskFull, IOError
- [ ] #13 All methods return Result[T, FileError] for explicit error handling
- [ ] #14 No exceptions thrown - errors returned as values

### Pure Functions (can be tested without file system)
- [ ] #15 `generate_unique_filename(name: str, existing: Set[str]) -> str` - adds suffix if needed
- [ ] #16 `parse_media_type(extension: str) -> Optional[SourceType]`
<!-- AC:END -->
